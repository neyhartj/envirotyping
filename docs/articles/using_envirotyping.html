<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>`envirotyping` Workflow • envirotyping</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="`envirotyping` Workflow">
<meta property="og:description" content="envirotyping">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">envirotyping</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/using_envirotyping.html">`envirotyping` Workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="using_envirotyping_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<code>envirotyping</code> Workflow</h1>
                        <h4 class="author">Jeff Neyhart</h4>
            
            <h4 class="date">January 07, 2021</h4>
      
      
      <div class="hidden name"><code>using_envirotyping.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In plant breeding, separating the effect of environment from genetics is crucial for more accurately selecting superior individual. Traditionally, environment is treated as a nuisance factor; however, identifying the specific components of an environment - namely weather, climate, or soil - that impact plants would be useful for improving selection or predicting crop performance. The <code>envirotyping</code> package is meant to simplify the process of gathering this explicit environmental data for routine plant breeding analyses.</p>
<div id="definitions" class="section level2">
<h2 class="hasAnchor">
<a href="#definitions" class="anchor"></a>Definitions</h2>
<p>Before proceeding, it might be useful to lay out some definitions of terms used throughout the workflow.</p>
<table class="table">
<colgroup>
<col width="29%">
<col width="70%">
</colgroup>
<thead><tr class="header">
<th>Term</th>
<th>Definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>environment</td>
<td>A specific combination of space and time (e.g. Saint Paul, MN in 2019); this can also be specific growing conditions (e.g. high nitrogen vs. low nitrogen)</td>
</tr>
<tr class="even">
<td>trial</td>
<td>An experiment conducted in a single environment (may be used interchangeably with “environment”).</td>
</tr>
<tr class="odd">
<td>location</td>
<td>A specific geographic point</td>
</tr>
<tr class="even">
<td>genotype</td>
<td>A genetically unique individual or line</td>
</tr>
<tr class="odd">
<td>environmental covariable</td>
<td>A variable the describes a specific condition within an environment; this could be, for instance, the soil pH at a location, the average temperature during a specific growth stage, etc.)</td>
</tr>
</tbody>
</table>
</div>
<div id="this-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#this-workflow" class="anchor"></a>This workflow</h2>
<p>This workflow will demonstrate the use of the package for obtaining environmental data that can be used in a quantitative genetic analysis. Figure 1 outlines a diagram of this workflow and what functions should be used.</p>
<p>The first thing you need to do is load the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.umn.edu/neyha001/envirotyping">envirotyping</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="data-assumptions-and-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#data-assumptions-and-examples" class="anchor"></a>Data assumptions and examples</h2>
<p>This workflow assumes that you have some specific information on environmental metadata, crop phenotypes, and genomic information; however, not all of this information is necessary for using functions in the <code>envirotyping</code> package. The table below outlines different data type and whether they are necessary for this workflow or for general use of the package.</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="29%">
<col width="25%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Data type</th>
<th>Description</th>
<th align="center">Required for general use?</th>
<th align="center">Required for this workflow?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>environmental metadata</td>
<td>Data describing a specific environment or trial (e.g. geographic coordinates, planting date, etc.)</td>
<td align="center">X</td>
<td align="center">X</td>
</tr>
<tr class="even">
<td>phenotypic data</td>
<td>Measurements of the performance of genotypes in a specific environment or environments for one or more traits</td>
<td align="center"></td>
<td align="center">X</td>
</tr>
<tr class="odd">
<td>genomic data</td>
<td>Genomewide marker data for the genotypes</td>
<td align="center"></td>
<td align="center">X</td>
</tr>
</tbody>
</table>
<p>The <code>envirotyping</code> package includes some sample data for demonstration in this workflow. These data are available when the package is loaded. <a href="https://pages.github.umn.edu/neyha001/envirotyping/reference/barley_ex_data.html">See this page</a> for a description of the data.</p>
</div>
</div>
<div id="querying-weather-and-soil-data" class="section level1">
<h1 class="hasAnchor">
<a href="#querying-weather-and-soil-data" class="anchor"></a>Querying weather and soil data</h1>
<p>The first step of using <code>envirotyping</code> is to obtain weather and soil data for the trials or environments of interest.</p>
<div id="get-daily-weather-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-daily-weather-data" class="anchor"></a>Get daily weather data</h2>
<p>Weather data is available as daily measurements from many sources. The Daymet database from NASA is a reliable source for high-resolution data. The <code><a href="../reference/get_weather_data.html">get_weather_data()</a></code> function queries this database using trial metadata (provided here in the <code>trial_info</code> object). This object must contain the trial name (“trial”), “year”, “latitude”, and “longitude”.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Retrieve daily weather observations in the same years as the trials</span>
<span class="va">daily_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_weather_data.html">get_weather_data</a></span><span class="op">(</span>trial.info <span class="op">=</span> <span class="va">trial_info</span><span class="op">)</span></code></pre></div>
<p>The output of this function is a <code>tibble</code> with all of the information from <code>trial_info</code>, but with a new column called <code>"data"</code> that is a list containing data frames of daily weather observations.</p>
</div>
<div id="get-soil-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-soil-data" class="anchor"></a>Get soil data</h2>
<p>The <code><a href="../reference/get_soil_data.html">get_soil_data()</a></code> function queries the <a href="http://www.fao.org/soils-portal/soil-survey/soil-maps-and-databases/harmonized-world-soil-database-v12/en/">Harmonized World Soil Database (HWSD)</a> to gather information on soil texture (% silt, sand, clay), organic matter, pH, bulk density, etc at each trial. To use this function, you must provide a path to the <code>hwsd.bil</code> file (which should be in a folder with other HWSD raster files). These files can be obtained from the link above and by navigating to “HWSD Raster” by the “Download” section.</p>
<p>Once you have a path to <code>hwsd.bil</code> file, you can pass that path to the <code><a href="../reference/get_soil_data.html">get_soil_data()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Path to the HWSD raster folder with hwsd.bil</span>
<span class="va">hwsd_path</span> <span class="op">&lt;-</span> <span class="st">"path/to/hwsd.bil"</span>

<span class="co"># Retrieve soil data for each location</span>
<span class="va">soil_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_soil_data.html">get_soil_data</a></span><span class="op">(</span>trial.info <span class="op">=</span> <span class="va">trial_info</span>, hwsd.path <span class="op">=</span> <span class="va">hwsd_path</span><span class="op">)</span></code></pre></div>
<p>Just like the <code><a href="../reference/get_weather_data.html">get_weather_data()</a></code> function, the output of this function is a <code>tibble</code> with all of the information from <code>trial_info</code>, but with a new column called <code>"data"</code> that is a list containing data frames of the soil data.</p>
</div>
<div id="get-historical-weather-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-historical-weather-data" class="anchor"></a>Get historical weather data</h2>
<p>If you would like to model the impact of a location using long-term historical data, you can use the <code><a href="../reference/get_historical_weather_data.html">get_historical_weather_data()</a></code> function to obtain daily weather measurements for a range of years at each of many locations:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Distinct set of location info</span>
<span class="va">location_info</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">trial_info</span>, <span class="va">location</span>, <span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span>

<span class="co"># Retrieve 5 years of historical daily weather observations</span>
<span class="va">historical_daily_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_historical_weather_data.html">get_historical_weather_data</a></span><span class="op">(</span>
  location.info <span class="op">=</span> <span class="va">location_info</span>, start.year <span class="op">=</span> <span class="fl">2010</span>, end.year <span class="op">=</span> <span class="fl">2014</span>
<span class="op">)</span></code></pre></div>
<blockquote>
<p>Note that the Daymet database <a href="https://daymet.ornl.gov/overview">only contains daily weather data going back to 1980</a>.</p>
</blockquote>
</div>
<div id="make-edits-to-weather-or-soil-data" class="section level2">
<h2 class="hasAnchor">
<a href="#make-edits-to-weather-or-soil-data" class="anchor"></a>Make edits to weather or soil data</h2>
<p>Sometimes, you might have external data to complement or replace the weather data obtained by <code><a href="../reference/get_weather_data.html">get_weather_data()</a></code>. For example, say you have obtained precipitation data, but want to add known irrigation applications on certain dates in a specific trial. You can use the <code><a href="../reference/edit_environmental_data.html">edit_environmental_data()</a></code> function to append or replace specific weather observation using a supplementary data object. In the example below, irrigation data is added to the precipitation observations (i.e. “rain”) from a single trial:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Modify the trial irrigation data to set irrigated water as "rain"</span>
<span class="va">trial_irrigation_data</span><span class="op">$</span><span class="va">rain</span> <span class="op">&lt;-</span> <span class="va">trial_irrigation_data</span><span class="op">$</span><span class="va">irrigation_mm</span>

<span class="co"># Edit the trial weather data with this irrigation information</span>
<span class="va">daily_weather1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/edit_environmental_data.html">edit_environmental_data</a></span><span class="op">(</span>env.data <span class="op">=</span> <span class="va">daily_weather</span>, suppl.data <span class="op">=</span> <span class="va">trial_irrigation_data</span>,
                                          operation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rain"</span> <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="reducing-data-dimensionality-by-summarizing-over-crop-growth-stages" class="section level1">
<h1 class="hasAnchor">
<a href="#reducing-data-dimensionality-by-summarizing-over-crop-growth-stages" class="anchor"></a>Reducing data dimensionality by summarizing over crop growth stages</h1>
<p>Daily weather observations are not very useful for statistical modeling, since there are likely many more explanatory variables than observations (i.e. a big <em>p</em>, small <em>n</em> problem). Further, daily weather may not be particularly relevant for crops planted at different dates. One way to reduce the dimensionality of this data and incorporate some prior biological is by summarizing environmental data according to known or predicted crop growth stages.</p>
<p>The steps below show how one can use a process-based crop model simulator to predict growth stages for summarizing data.</p>
<div id="running-a-crop-model" class="section level2">
<h2 class="hasAnchor">
<a href="#running-a-crop-model" class="anchor"></a>Running a crop model</h2>
<p>The specific timing of crop growth stages may be recorded during the course of a trial, but often this information is not available. An alternative is to use the daily weather conditions to predict the timing of specific growth stages. This might be done using a simple growing degree day model or more complex process-based simulators such as <a href="https://www.apsim.info/">APSIM</a> or <a href="https://dssat.net/">DSSAT</a>.</p>
<p>The <code>envirotyping</code> package includes a function, <code><a href="../reference/run_apsim_crop_model.html">run_apsim_crop_model()</a></code>, for running APSIM simulations. To support this function, the package is also distributed with an example <code>.apsimx</code> file for running a barley crop simulation (more examples are forthcoming). You may specify your own base crop model file using the <code>base.model.path</code> argument. This base model will be modified using the planting date information and weather data provided in the <code>env.data</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run a crop model for each trial</span>
<span class="va">trial_crop_growth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_apsim_crop_model.html">run_apsim_crop_model</a></span><span class="op">(</span>env.data <span class="op">=</span> <span class="va">daily_weather1</span>, base.model.path <span class="op">=</span> <span class="st">"barley"</span><span class="op">)</span></code></pre></div>
<p>The output of this function is quite similar to the input, <code>daily_weather</code>, but the elements of the <code>data</code> list have been edited to include the output of the crop growth model.</p>
</div>
<div id="define-growth-stages" class="section level2">
<h2 class="hasAnchor">
<a href="#define-growth-stages" class="anchor"></a>Define growth stages</h2>
<p>The output of the barley crop model in the example above includes a continuous variable called <code>zadok_stage</code>, which defines the numeric growth stage according to the Zadoks scale. This information can be used to delineate the beginning and ending of discrete growth stages, during which environmental data will be summarized.</p>
<p>The <code><a href="../reference/define_growth_stages.html">define_growth_stages()</a></code> function uses inequality expressions to define the span of specific growth stages. This requires some prior understanding of what numeric crop developmental information corresponds to what discrete growth stages. An example for barley is provided below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a list of growth stages delineated by a variable "x"</span>
<span class="va">barley_stages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
 early_vegetative <span class="op">=</span> <span class="st">"x &gt;= 10 &amp; x &lt;= 30"</span>, late_vegetative <span class="op">=</span> <span class="st">"x &gt; 30 &amp; x &lt;= 50"</span>,
 flowering <span class="op">=</span> <span class="st">"x &gt; 50 &amp; x &lt;= 70"</span>, grain_fill <span class="op">=</span> <span class="st">"x &gt; 70 &amp; x &lt;= 91"</span>
<span class="op">)</span></code></pre></div>
<p>Here, <code>x</code> refers to whatever numeric variable will be used in the inequality expressions provided in a list (the <code>barley_stages</code> object above). The name of this variable is passed using the <code>growth.stage.delim</code> argument in the <code><a href="../reference/define_growth_stages.html">define_growth_stages()</a></code> function. An example is below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use these delineations to mark growth stages from the crop model</span>
<span class="va">trial_crop_stages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_growth_stages.html">define_growth_stages</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">trial_crop_growth</span>, 
  growth.stage.delim <span class="op">=</span> <span class="st">"zadok"</span>, 
  stages <span class="op">=</span> <span class="va">barley_stages</span>
<span class="op">)</span></code></pre></div>
<p>The output of this function again resembles the input (<code>trial_crop_growth</code>) or the output of the <code><a href="../reference/get_weather_data.html">get_weather_data()</a></code> or <code><a href="../reference/get_soil_data.html">get_soil_data()</a></code> functions. Again, the elements of the <code>data</code> list have been edited to include another column (<code>growth_stage</code>) that adds the discrete growth stages passed in the <code>stages</code> argument.</p>
<p>The elements of the list passed in the <code>stages</code> argument must be characters that define inequality expressions. Here is what happens when those elements cannot be parsed as expressions:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The early_vegatative element is not an expression</span>
<span class="va">stages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
 early_vegetative <span class="op">=</span> <span class="st">"x 10 &amp; x &lt;= 30"</span>, late_vegetative <span class="op">=</span> <span class="st">"x &gt; 30 &amp; x &lt;= 50"</span>,
 flowering <span class="op">=</span> <span class="st">"x &gt;  50 &amp; x &lt;= 70"</span>, grain_fill <span class="op">=</span> <span class="st">"x &gt; 70 &amp; x &lt;= 91"</span>
<span class="op">)</span>

<span class="co"># Use these delineations to mark growth stages from the crop model</span>
<span class="fu"><a href="../reference/define_growth_stages.html">define_growth_stages</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">trial_crop_growth</span>, 
  growth.stage.delim <span class="op">=</span> <span class="st">"zadok"</span>, 
  stages <span class="op">=</span> <span class="va">stages</span>
<span class="op">)</span></code></pre></div>
<p><img src="figures/error1.png"></p>
<p>Additionally, the use of the dummy variable <code>x</code> is required. The function will automatically convert this dummy to whatever variable is passed in the <code>growth.stage.delim</code> argument. Here is what happens when <code>x</code> is not included in the list of expressions:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This list uses the variable name to be passes in growth.stage.delim</span>
<span class="va">stages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
 early_vegetative <span class="op">=</span> <span class="st">"zadok 10 &amp; zadok &lt;= 30"</span>, 
 late_vegetative <span class="op">=</span> <span class="st">"zadok &gt; 30 &amp; zadok &lt;= 50"</span>,
 flowering <span class="op">=</span> <span class="st">"zadok &gt;  50 &amp; zadok &lt;= 70"</span>, 
 grain_fill <span class="op">=</span> <span class="st">"zadok &gt; 70 &amp; zadok &lt;= 91"</span>
<span class="op">)</span>

<span class="co"># Use these delineations to mark growth stages from the crop model</span>
<span class="fu"><a href="../reference/define_growth_stages.html">define_growth_stages</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">trial_crop_growth</span>, 
  growth.stage.delim <span class="op">=</span> <span class="st">"zadok_stage"</span>, 
  stages <span class="op">=</span> <span class="va">stages</span>
<span class="op">)</span></code></pre></div>
<p><img src="figures/error2.png"></p>
</div>
<div id="summarize-weather-data-according-to-growth-stages" class="section level2">
<h2 class="hasAnchor">
<a href="#summarize-weather-data-according-to-growth-stages" class="anchor"></a>Summarize weather data according to growth stages</h2>
<p>Once discrete growth stages are assigned, the next step is to summarize the daily weather observations within each of those stage. The <code><a href="../reference/summarize_environmental_data.html">summarize_environmental_data()</a></code> function provides a simple way to calculate these summaries.</p>
<p>The most important argument to this function is <code>.funs</code>, which allows the user to provide variable-specific summary functions. For instance, growing degree days are usually expressed as an accumulated value (a cumulative sum), while temperature might be summarized as an arithmetic average. <code>.funs</code> takes a list of formula-based functions; the names of this list are the variables you wish to summarize. For example, if you wanted to calculate the cumulative rainfall and average maximum temperature during each growth stage, the <code>.funs</code> argument would look like this:</p>
<pre><code>.funs &lt;- list(rain = ~sum, maxt = ~mean)</code></pre>
<p>Any functions that return a single value can be passed.</p>
<p>Below is an example of using the <code><a href="../reference/summarize_environmental_data.html">summarize_environmental_data()</a></code> on the daily weather variable with assigned growth stages. The <code>unite</code> argument, when set to <code>TRUE</code>, combines the growth stage and variable into a single variable and provides a single-row data frame of summarized data. If not switched, the output is a tidy table of growth stage, variable, and value.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A list defining how to summarize each variable</span>
<span class="va">summary_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rain <span class="op">=</span> <span class="op">~</span><span class="va">sum</span>, radn <span class="op">=</span> <span class="op">~</span><span class="va">sum</span>, maxt <span class="op">=</span> <span class="op">~</span><span class="va">mean</span>, mint <span class="op">=</span> <span class="op">~</span><span class="va">mean</span>, daylength <span class="op">=</span> <span class="op">~</span><span class="va">mean</span><span class="op">)</span>

<span class="co"># Summarize environmental data according to the growth stages</span>
<span class="va">trial_data_summarized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_environmental_data.html">summarize_environmental_data</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">trial_crop_stages</span>,
  growth.stage.col <span class="op">=</span> <span class="st">"growth_stage"</span>,
  .funs <span class="op">=</span> <span class="va">summary_funs</span>,
  unite <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p>You will notice in the output of this function that elements of the <code>data</code> list contain only a single row - 1 for each trial - instead of 365 rows for data from each date.</p>
</div>
<div id="repeat-these-procedures-for-historical-weather-data" class="section level2">
<h2 class="hasAnchor">
<a href="#repeat-these-procedures-for-historical-weather-data" class="anchor"></a>Repeat these procedures for historical weather data</h2>
<p>The same steps can be followed for assigning growth stages to historical daily weather data and summarizing those variables. Unlike the daily weather data collected above, historical weather data might be collected absent any trial that is conducted at a location during the years covered by the historical data. To run a crop model, we therefore need to predict some of the important metadata for a trial that would <em>theoretically</em> been conducted at that location in a historical year; namely, the planting date must be determined.</p>
<p>A useful resource for predicting planting dates is the <a href="http://nelson.wisc.edu/sage/data-and-models/crop-calendar-dataset/">Crop Calendar Dataset</a>, which includes historical average planting and harvest date information for several crop species across the world. A convenient CSV file that contains this data can be downloaded from the website linked above, or by running the following code:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Download the crop calendar data</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"http://nelson.wisc.edu/sage/data-and-models/crop-calendar-dataset/All_data_with_climate.csv"</span>
<span class="va">crop_calendar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></code></pre></div>
<p>This will read the crop calendar data into your R environment.</p>
<p>The <code><a href="../reference/predict_historical_planting_dates.html">predict_historical_planting_dates()</a></code> function will use this information along with the historical daily weather data you have obtained to predict the planting date of a specific crop. While the function relies on historical average planting dates, you can tune the function to include heuristics into the planting decision-making.</p>
<p>For example, the code below will predict planting dates for spring barley, but will search for dates that i) have a mean temperature that is not more than 2 degrees (C) colder than the average planting date temperature; ii) experience a daylength that is not more than 0.5 hours less than the average planting date daylength; iii) had a minimum temperature above 0 degrees (C), and iv) had a maximum rainfall of 0.5 mm (i.e. one usually doesn’t plant when it’s raining).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predict planting dates</span>
<span class="va">historical_daily_weather1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_historical_planting_dates.html">predict_historical_planting_dates</a></span><span class="op">(</span>
 env.data <span class="op">=</span> <span class="va">historical_daily_weather</span>, 
 crop <span class="op">=</span> <span class="st">"barley - spring"</span>,
 crop.calendar <span class="op">=</span> <span class="va">crop_calendar</span>,
 meant.adj <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, daylen.adj <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,
 mint.lower <span class="op">=</span> <span class="fl">0</span>, rain.upper <span class="op">=</span> <span class="fl">0.5</span>
<span class="op">)</span></code></pre></div>
<p>The output of this function is a modified version of the <code>historical_daily_weather</code> data frame with two new columns: a <code>closest_location</code> column that notes the location in the crop calendar the provided the average planting date information, and a <code>planting_date</code> column with the predicted planting date.</p>
<p>Once planting dates are known or predicted, the remaining steps are similar to those above. First, crop growth is simulated for each location and year of historical data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run a crop model for each historical "trial"</span>
<span class="va">hist_crop_growth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_apsim_crop_model.html">run_apsim_crop_model</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">historical_daily_weather1</span>, base.model.path <span class="op">=</span> <span class="st">"barley"</span>
<span class="op">)</span></code></pre></div>
<p>Next, growth stages are defined:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define growth stages using the same set of barley stages</span>
<span class="va">hist_crop_stages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_growth_stages.html">define_growth_stages</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">hist_crop_growth</span>, 
  growth.stage.delim <span class="op">=</span> <span class="st">"zadok"</span>, 
  stages <span class="op">=</span> <span class="va">barley_stages</span>
<span class="op">)</span></code></pre></div>
<p>Finally, weather data is summarized within each discrete growth stage:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize data using these growth stages</span>
<span class="va">hist_data_summarized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_environmental_data.html">summarize_environmental_data</a></span><span class="op">(</span>
  env.data <span class="op">=</span> <span class="va">hist_crop_stages</span>, 
  .funs <span class="op">=</span> <span class="va">summary_funs</span>,
  unite <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="creating-environmental-covariable-matrices" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-environmental-covariable-matrices" class="anchor"></a>Creating environmental covariable matrices</h1>
<p>The final step in making the environmental data useful for modeling or prediction is to create matrices of environmental covariables. These will take the shape of a <span class="math inline">\(n \times p\)</span> matrix, where <span class="math inline">\(n\)</span> indicates the number of environments (or locations) and <span class="math inline">\(p\)</span> indicates the number of covariables.</p>
<div id="merge-sets-of-environmental-data" class="section level2">
<h2 class="hasAnchor">
<a href="#merge-sets-of-environmental-data" class="anchor"></a>Merge sets of environmental data</h2>
<p>First, while we have summarized weather data, we need to merge this with the soil data we already collected (but, up until now, have not manipulated). A convenience function, <code><a href="../reference/merge_environmental_data.html">merge_environmental_data()</a></code> allows one to merge different environmental datasets together for the same trials.</p>
<p>Here is an example of merging the summarized daily weather data and the soil data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Merge the daily weather data (summarized by growth stage) with the soil data</span>
<span class="va">daily_weather_soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_environmental_data.html">merge_environmental_data</a></span><span class="op">(</span><span class="va">trial_data_summarized</span>, <span class="va">soil_data</span><span class="op">)</span></code></pre></div>
<p>Note that this function will merge data frames based on any and all common columns. So, you could not merge the daily summarized weather data and the historical summarized weather data, because they do not share trial names:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This will produce a data frame with zero rows</span>
<span class="fu"><a href="../reference/merge_environmental_data.html">merge_environmental_data</a></span><span class="op">(</span><span class="va">trial_data_summarized</span>, <span class="va">hist_data_summarized</span><span class="op">)</span></code></pre></div>
<p>However, you can merge the historical summarized weather data with the soil data because they share locations:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Merge the historical weather data (summarized by growth stage) with the soil data</span>
<span class="co"># This function will merge based on location</span>
<span class="va">hist_weather_soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_environmental_data.html">merge_environmental_data</a></span><span class="op">(</span>
  <span class="va">hist_data_summarized</span>, 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">soil_data</span>, <span class="va">location</span>, <span class="va">data</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="create-an-environmental-covariable-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#create-an-environmental-covariable-matrix" class="anchor"></a>Create an environmental covariable matrix</h2>
<p>The output of the <code><a href="../reference/merge_environmental_data.html">merge_environmental_data()</a></code> function are just like its inputs, which include a column called <code>data</code> that is a list of data frames. We need to unnest this list of data frames to make it useful. The <code>tidyr</code> package provides an easy function to do that:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the tidyr package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>

<span class="co"># Reshape the data</span>
<span class="va">daily_weather_soil1</span> <span class="op">&lt;-</span> <span class="va">daily_weather_soil</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span>, <span class="st">"elevation"</span>, 
                            <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_weather_soil</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The output of this code is a data frame in tidy long format, where each line is the value of a single environmental covariable in a single environment or trial (along with all of the relevant metadata for that trial). This data frame can be used for other summary functions or for however you please, but it can also be passed to another function, <code><a href="../reference/ec_matrix.html">ec_matrix()</a></code>, that will calculate the <span class="math inline">\(n \times p\)</span> matrix of environmental covariables.</p>
<p>This function simply requires the names of columns that contain the trial names, the names of the environmental covariables, and the value of that covariable. The function automatically will run a few basic quality control steps, including a test for variation (any covariable with no variation is removed) and a test for normality.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a n x p environmental covariable matrix</span>
<span class="va">daily_ecmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_matrix.html">ec_matrix</a></span><span class="op">(</span>env.data <span class="op">=</span> <span class="va">daily_weather_soil1</span>, env.col <span class="op">=</span> <span class="st">"trial"</span>, 
                         var.col <span class="op">=</span> <span class="st">"variable"</span>, val.col <span class="op">=</span> <span class="st">"value"</span>, check.data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The output of this function is a <code>matrix</code> object of (by default) centered and scaled environmental covariable data.</p>
<p>A similar process can be used for the historical data. However, as the historical data is usually meant to better describe the average effect of a location over time, you will need to summarize the historical environmental covariables across years before creating an environmental covariable matrix.</p>
<p>First, you need to unnest and reshape the historical data just like the daily environmental data:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Reshape the data</span>
<span class="va">hist_weather_soil1</span> <span class="op">&lt;-</span> <span class="va">hist_weather_soil</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">value</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span>, <span class="st">"elevation"</span>, 
                            <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hist_weather_soil</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Next, you can use built-in R functions for summarizing the historical data across years. Suppose from this historical data that spans 2010-2014, you want to summarize across the years 2012-2014. You can use functions like <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> to summarize the value of each environmental covariable across several years</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate the average value of each covariable in each location over a few years</span>
<span class="va">hist_weather_soil_aggregated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">variable</span> <span class="op">+</span> <span class="va">location</span>, data <span class="op">=</span> <span class="va">hist_weather_soil1</span>, 
                                          FUN <span class="op">=</span> <span class="va">mean</span>, subset <span class="op">=</span> <span class="va">year</span> <span class="op">%in%</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/ec_matrix.html">ec_matrix()</a></code> function can then be used to produce the environmental covariable matrix:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a n x p environmental covariable matrix</span>
<span class="va">hist_ecmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_matrix.html">ec_matrix</a></span><span class="op">(</span>env.data <span class="op">=</span> <span class="va">hist_weather_soil_aggregated</span>, env.col <span class="op">=</span> <span class="st">"location"</span>, 
                        var.col <span class="op">=</span> <span class="st">"variable"</span>, val.col <span class="op">=</span> <span class="st">"value"</span>, check.data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="case-study-1-using-environmental-data-in-genomic-prediction" class="section level1">
<h1 class="hasAnchor">
<a href="#case-study-1-using-environmental-data-in-genomic-prediction" class="anchor"></a>Case study 1: using environmental data in genomic prediction</h1>
<p>This case study will examine a example of using the environmental covariable data gathered above. In this example, we will use the environmental covariable data in a unified prediction model that includes genomic information.</p>
<p>We will demonstrate using a Genomic-Best Linear Unbiased Prediction (GBLUP) mixed-effect model:</p>
<p><span class="math display">\[
y_{ij} = \mu + g_i + t_i + (gt)_{ij} + \epsilon_{ij},
\]</span></p>
<p>where <span class="math inline">\(y_{ij}\)</span> is the mean of the <em>i</em>th genotype in the <em>j</em>th environment, <span class="math inline">\(\mu\)</span> is the grand mean, <span class="math inline">\(g_i\)</span> is the random effect of the <em>i</em>th genotype, <span class="math inline">\(t_i\)</span> is the random effect of the <em>j</em>th environment, <span class="math inline">\((gt)_{ij}\)</span> is the random effect of the <em>ij</em>th genotype-environment combination (interaction) and <span class="math inline">\(\epsilon_{ij}\)</span> is error.</p>
<p>The genomic and environmental covariable data will be integrated in covariance matrices that model the random effect <span class="math inline">\(g_i\)</span>, <span class="math inline">\(t_i\)</span>, and <span class="math inline">\((gt)_{ij}\)</span>. In this case:</p>
<ul>
<li><span class="math inline">\(g_i \sim N(0, \mathbf{G}\sigma^2_g)\)</span></li>
<li><span class="math inline">\(t_i \sim N(0, \mathbf{E}\sigma^2_g)\)</span></li>
<li><span class="math inline">\((gt)_{ij} \sim N(0, \mathbf{(G \otimes E})\sigma^2_g)\)</span></li>
</ul>
<p><span class="math inline">\(\mathbf{G}\)</span> is a genomic relationship matrix, <span class="math inline">\(\mathbf{E}\)</span> is an environmental “relationship” matrices calculated using environmental covariables, and <span class="math inline">\(\mathbf{(G \otimes E})\)</span> denotes the Kronecker product between those two matrices.</p>
<div id="creating-the-environmental-relationship-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-environmental-relationship-matrix" class="anchor"></a>Creating the environmental “relationship” matrix</h2>
<p>The environmental “relationship” matrix (or, more accurately, the covariance matrix) mentioned above is created directly from environmental covariables. This matrix shares some similarity with the genomic relationship matrix: both approximate the covariance between their respective factors (environments or genotypes); however, while there is theory supporting the use of genomic markers to approximate genotypic covariance as a function of degree of relationship (i.e. coefficients of coancestry), no such theory exists for environments. Nevertheless, this does not stop us from using similar formulas to calculate the environmental “relationship” matrix.</p>
<p>The sections below detail different cases in constructing environmental “relationship” matrices.</p>
<div id="using-all-available-environmental-covariables" class="section level3">
<h3 class="hasAnchor">
<a href="#using-all-available-environmental-covariables" class="anchor"></a>Using all available environmental covariables</h3>
<p>One option for calculating the “relationship” matrix is to use all available environmental covariables. This method relies on the idea that more measurements of explicit environmental conditions (i.e. weather, soil, etc.) will more closely capture the total unique environmental conditions experienced by the crop, and it is this entirety that determines eventual phenotypic outcomes. This is analogous to using all available genomic markers to model the relationship between genotypes.</p>
<p>Constructing the environmental “relationship” matrix can be accomplished by using the <code><a href="../reference/ec_relmat.html">ec_relmat()</a></code> function. If you want to use all possible environmental covariables, simply pass the covariable matrix (i.e. from the <code><a href="../reference/ec_matrix.html">ec_matrix()</a></code> function) to this function:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Construct a relationship matrix for environments</span>
<span class="va">env_all_relmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_relmat.html">ec_relmat</a></span><span class="op">(</span>ec.matrix <span class="op">=</span> <span class="va">daily_ecmat</span><span class="op">)</span>

<span class="co"># Construct a relationship matrix for locations using historical data:</span>
<span class="va">loc_all_relmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_relmat.html">ec_relmat</a></span><span class="op">(</span>ec.matrix <span class="op">=</span> <span class="va">hist_ecmat</span><span class="op">)</span></code></pre></div>
<p>This function includes other options for weighing different covariables or using different formulas for calculating the relationship matrix. See the help page for this function for more information.</p>
</div>
<div id="selecting-important-environmental-covariables" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-important-environmental-covariables" class="anchor"></a>Selecting important environmental covariables</h3>
<p>A different option for calculating the “relationship” matrix is to use known phenotypic observations and a variable selection or feature identification method to determine the most important environmental covariables. This method relies on the idea that certain environmental conditions impact crop phenotypic outcomes, and those are the most useful for prediction.</p>
<p>This package includes a function, <code><a href="../reference/ec_variable_selection.html">ec_variable_selection()</a></code>, that performs variable selection based on linear mixed models and stepwise addition of variables. The function will continue to add variables to a model so long as the performance of the model (measured using cross-validation) continues to improve. This method of stepwise variable selection aims to minimize overfitting and select variables that will be most useful for prediction.</p>
<p>The function requires phenotype data in order to proceed. This must be observations for a single trait measured on (ideally) many genotypes in (ideally) many environments (the same environments for which you should now have explicit covariables). The default variable search method for this function is the linear mixed model, which takes the form:</p>
<p><span class="math display">\[
y_{ij} = \mu + g_i + \sum^P_{p=1}\beta_p x_{jp} + \epsilon_{ij},
\]</span> where <span class="math inline">\(y_{ij}\)</span>, <span class="math inline">\(\mu\)</span>, and <span class="math inline">\(g_i\)</span> are the same as defined above, except no relationship matrix is used to model the covariance between genotypes; <span class="math inline">\(\beta_p\)</span> is the regression coefficient of the <em>p</em>th covariable, and <span class="math inline">\(x_{jp}\)</span> is the value of the <em>p</em>th environmental covariable in the <em>j</em>th environment.</p>
<p>Here is an example of using the <code><a href="../reference/ec_variable_selection.html">ec_variable_selection()</a></code> function to determine important environmental covariables:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use stepwise regression to determine the important set of environmental</span>
<span class="co"># covariables</span>
<span class="va">variable_selection_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_variable_selection.html">ec_variable_selection</a></span><span class="op">(</span>
 pheno.data <span class="op">=</span> <span class="va">pheno_data_train</span>, 
 env.data <span class="op">=</span> <span class="va">daily_weather_soil1</span>, 
 env.col <span class="op">=</span> <span class="st">"trial"</span>,
 gen.col <span class="op">=</span> <span class="st">"line_name"</span>, 
 y.col <span class="op">=</span> <span class="st">"value"</span>, 
 var.col <span class="op">=</span> <span class="st">"variable"</span>,
 val.col <span class="op">=</span> <span class="st">"value"</span>
<span class="op">)</span></code></pre></div>
<p>This function returns a list containing the results of the variable selection and the names of the selected covariables. See the help file for this function for more information about its output.</p>
<p>You can then use the names of the selected covariables to subset the full environmental covariable matrix and calculate a “relationship” matrix based only on those covariables:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subset the environmental covariable matrix based on the results of the </span>
<span class="co"># variable selection operation</span>
<span class="va">daily_ecmat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset.matrix</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">daily_ecmat</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">variable_selection_out</span><span class="op">$</span><span class="va">optVariables</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create the relationship matrix</span>
<span class="va">env_sel_relmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_relmat.html">ec_relmat</a></span><span class="op">(</span>ec.matrix <span class="op">=</span> <span class="va">daily_ecmat1</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-historical-environmental-covariables" class="section level3">
<h3 class="hasAnchor">
<a href="#model-historical-environmental-covariables" class="anchor"></a>Model historical environmental covariables</h3>
<p>A similar variable selection approach can be used to determine the important historical environmental covariables; however, there is an additional variable of time that needs to be considered. Historical environmental data is collected on a per-year basis; this data, intended to model the impact of location, needs to be summarized over years, but the ideal time frame (i.e. number of years) over which to summarize may not be known.</p>
<p>You can measure this empirically by performing variable selection over different time frames and determining that which maximizes model performance. This capability is provided by the <code><a href="../reference/ec_variable_selection.html">ec_variable_selection_slide()</a></code> function, which extends the <code><a href="../reference/ec_variable_selection.html">ec_variable_selection()</a></code> function over different time frames.</p>
<p>To use this function, you first need to create a list of years that form the time frames of interest. For example, below we create a list of accumulating years and a list of equal number of years across a sliding window:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a list of years that accumulate from latest to earliest</span>
<span class="va">timeframe_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hist_weather_soil1</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, accumulate <span class="op">=</span> <span class="cn">TRUE</span>, right <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Create a list of years forming a sliding window of two years</span>
<span class="co"># Use the slider package to create this</span>
<span class="va">window_list</span> <span class="op">&lt;-</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/slider/man/slide.html">slide</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hist_weather_soil1</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, .f <span class="op">=</span> <span class="va">c</span>,
                             .after <span class="op">=</span> <span class="fl">1</span>, .step <span class="op">=</span> <span class="fl">1</span>, .complete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># Remove NULL elements</span>
<span class="va">window_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">window_list</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">window_list</span>, <span class="va">is.null</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You will notice that the <code>timeframe_list</code> object contains elements of different lengths (i.e. increasing the number of years over which data will be summarized), while the <code>window_list</code> object contains elements of equal length.</p>
<p>The <code><a href="../reference/ec_variable_selection.html">ec_variable_selection_slide()</a></code> function can then be used to identify the best time frame.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add location information to the pheno_data_train object</span>
<span class="va">pheno_data_train1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">pheno_data_train</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span>, <span class="va">trial_info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"trial"</span>, <span class="st">"location"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Variable selection using the list of time frames</span>
<span class="va">timeframe_ec_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_variable_selection.html">ec_variable_selection_slide</a></span><span class="op">(</span>
  pheno.data <span class="op">=</span> <span class="va">pheno_data_train1</span>, env.data <span class="op">=</span> <span class="va">hist_weather_soil1</span>, 
  env.col <span class="op">=</span> <span class="st">"location"</span>, gen.col <span class="op">=</span> <span class="st">"line_name"</span>, y.col <span class="op">=</span> <span class="st">"value"</span>, 
  var.col <span class="op">=</span> <span class="st">"variable"</span>, val.col <span class="op">=</span> <span class="st">"value"</span>, time.col <span class="op">=</span> <span class="st">"year"</span>, 
  time.list <span class="op">=</span> <span class="va">timeframe_list</span>
<span class="op">)</span>

<span class="co"># Variable selection using the list of sliding windows</span>
<span class="va">window_ec_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_variable_selection.html">ec_variable_selection_slide</a></span><span class="op">(</span>
  pheno.data <span class="op">=</span> <span class="va">pheno_data_train1</span>, env.data <span class="op">=</span> <span class="va">hist_weather_soil1</span>, 
  env.col <span class="op">=</span> <span class="st">"location"</span>, gen.col <span class="op">=</span> <span class="st">"line_name"</span>, y.col <span class="op">=</span> <span class="st">"value"</span>, 
  var.col <span class="op">=</span> <span class="st">"variable"</span>, val.col <span class="op">=</span> <span class="st">"value"</span>, time.col <span class="op">=</span> <span class="st">"year"</span>, 
  time.list <span class="op">=</span> <span class="va">window_list</span>
<span class="op">)</span></code></pre></div>
<p>The results of the time frame selection based on accumulating years (i.e. <code>timeframe_ec_sel$timeframeFinalCVResults</code>) indicates that summarizing historical data between 2013 and 2014 was best; based on a sliding window (i.e. <code>window_ec_sel$timeframeFinalCVResults</code>), summarizing data between 2011 and 2012 was best. Both results are quite similar (based on root mean squared error), though the sliding window approach results in a slightly lower RMSE.</p>
<p>The <code><a href="../reference/ec_variable_selection.html">ec_variable_selection_slide()</a></code> output includes a environmental covariable matrix with values of all covariables summarized across the optimal time frame. You can then subset this matrix for the covariables that were determined to be most important by the variable selection procedure:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Extract the historical environmental covariable matrix</span>
<span class="va">hist_ecmat1</span> <span class="op">&lt;-</span> <span class="va">window_ec_sel</span><span class="op">$</span><span class="va">ecMatrixSelected</span>
<span class="co"># Subset for the important covariables</span>
<span class="va">hist_ecmat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset.matrix</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hist_ecmat1</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">window_ec_sel</span><span class="op">$</span><span class="va">variableSelectionResults</span><span class="op">$</span><span class="va">optVariables</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Construct a relationship matrix</span>
<span class="va">hist_sel_relmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_relmat.html">ec_relmat</a></span><span class="op">(</span>ec.matrix <span class="op">=</span> <span class="va">hist_ecmat1</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="using-environmental-relationship-matrices-for-genomic-prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#using-environmental-relationship-matrices-for-genomic-prediction" class="anchor"></a>Using environmental “relationship” matrices for genomic prediction</h2>
<p>Once the environmental “relationship” matrices are constructed, they can be used in genomic prediction models in the same way that markers are used: model the covariance between (in this case) environments or predict the value of unobserved environments. Below are examples of fitting the model mentioned above using genomic data, environmental data, and their interaction to predict the phenotypes of previously unobserved genotypes in previously unobserved environments.</p>
<p>In both cases, marker data is used to model the covariance between genotypes via a relationship matrix. This matrix is already provided in the package as the data object <code>Gmat</code>.</p>
<div id="predictions-in-previously-unobserved-environments" class="section level3">
<h3 class="hasAnchor">
<a href="#predictions-in-previously-unobserved-environments" class="anchor"></a>Predictions in previously unobserved environments</h3>
<p>To make predictions in previously unobserved environments, we use the environmental “relationship” matrix created from the in-season weather and soil data (i.e. <code>env_sel_relmat</code> in this example). We use the <code><a href="https://rdrr.io/pkg/sommer/man/mmer.html">mmer()</a></code> function from the <code>sommer</code> package to fit the model and generate predictions:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Rename the relationship matrices for consistency</span>
<span class="va">Emat</span> <span class="op">&lt;-</span> <span class="va">env_sel_relmat</span>
<span class="va">Gmat</span> <span class="op">&lt;-</span> <span class="va">Gmat</span>
<span class="co"># The kronecker product models the interaction between the two matrices</span>
<span class="va">GEmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html">kronecker</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Gmat</span>, Y <span class="op">=</span> <span class="va">Emat</span>, make.dimnames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Subset phenotype data based on the genotypes that are in the Gmat</span>
<span class="va">pheno_data_train2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">pheno_data_train1</span>, <span class="va">line_name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">Gmat</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Add factors for genotypes and environments</span>
<span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">line_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">line_name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">Gmat</span><span class="op">)</span><span class="op">)</span>
<span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">trial</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">Emat</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Add a factor for interactions</span>
<span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">gxe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">line_name</span>, <span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">trial</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span>

<span class="co"># Train the model using sommer</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">sommer</span><span class="op">)</span>
<span class="va">model_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sommer/man/mmer.html">mmer</a></span><span class="op">(</span>
  fixed <span class="op">=</span> <span class="va">value</span> <span class="op">~</span> <span class="fl">1</span>,
  random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/sommer/man/vs.html">vs</a></span><span class="op">(</span><span class="va">line_name</span>, Gu <span class="op">=</span> <span class="va">Gmat</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/sommer/man/vs.html">vs</a></span><span class="op">(</span><span class="va">trial</span>, Gu <span class="op">=</span> <span class="va">Emat</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/sommer/man/vs.html">vs</a></span><span class="op">(</span><span class="va">gxe</span>, Gu <span class="op">=</span> <span class="va">GEmat</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">pheno_data_train2</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p>After the model is fit, use a separate data frame of targets to generate the predictions. Below we use the data object <code>pheno_data_test</code> to validate predictions.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add the same levels to factors in pheno_data_target</span>
<span class="va">pheno_data_test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">pheno_data_test</span>, <span class="va">line_name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">Gmat</span><span class="op">)</span><span class="op">)</span>
<span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">line_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">line_name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">line_name</span><span class="op">)</span><span class="op">)</span>
<span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">trial</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">pheno_data_train2</span><span class="op">$</span><span class="va">trial</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Add a factor for interactions</span>
<span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">gxe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">line_name</span>, <span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">trial</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span>


<span class="co">## Retrieve the predicted values</span>
<span class="co"># Grand mean</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">model_train</span><span class="op">$</span><span class="va">Beta</span><span class="op">$</span><span class="va">Estimate</span>

<span class="co"># Genotypes</span>
<span class="va">Z_genotypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">line_name</span>, <span class="va">pheno_data_test1</span><span class="op">)</span>
<span class="va">u_genotypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">model_train</span><span class="op">$</span><span class="va">U</span><span class="op">$</span><span class="va">`u:line_name`</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>
<span class="co"># Environments</span>
<span class="va">Z_environments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">trial</span>, <span class="va">pheno_data_test1</span><span class="op">)</span>
<span class="va">u_environments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">model_train</span><span class="op">$</span><span class="va">U</span><span class="op">$</span><span class="va">`u:trial`</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>
<span class="co"># GxE</span>
<span class="va">Z_gxe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">gxe</span>, <span class="va">pheno_data_test1</span><span class="op">)</span>
<span class="va">u_gxe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">model_train</span><span class="op">$</span><span class="va">U</span><span class="op">$</span><span class="va">`u:gxe`</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>

<span class="co"># Generate predictions</span>
<span class="va">pred_vals</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">+</span> <span class="op">(</span><span class="va">Z_genotypes</span> <span class="op">%*%</span> <span class="va">u_genotypes</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">Z_environments</span> <span class="op">%*%</span> <span class="va">u_environments</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">Z_gxe</span> <span class="op">%*%</span> <span class="va">u_gxe</span><span class="op">)</span>

<span class="co"># Add the predicted values to the data.frame</span>
<span class="va">pheno_data_test1</span><span class="op">$</span><span class="va">predValues</span> <span class="op">&lt;-</span> <span class="va">pred_vals</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>

<span class="co"># Measure the model performance by calculating the root mean squared error</span>
<span class="co"># and correlation between predicted and observed phenotypes</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="va">pheno_data_test1</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">predValues</span><span class="op">)</span>,
            RMSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">value</span> <span class="op">-</span> <span class="va">predValues</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeff Neyhart.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
